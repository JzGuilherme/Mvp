<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ManUp - Fórum da Comunidade</title>
  <link rel="icon" type="image/png" href="../imagens/MAISLOGO.png"">  
  <!-- Dependências de Fontes (Google Fonts e Ícones) -->
  <link href=" https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

  <!-- Folhas de Estilo (CSS) -->
  <link rel="stylesheet" href="../cstop/style.css" />
  <link rel="stylesheet" href="../cstop/faq.css" />
</head>

<body>
  <div class="app-container">

    <!-- Cabeçalho Global -->
    <header class="app-header">
      <a href="dashboard.html" class="logo">ManUp</a>
      <div class="user-menu">
        <span>Olá, <strong class="nome-usuario"></strong><strong>!</strong></span>
        <a href="login.html" class="btn-logout">Sair</a>
      </div>
    </header>

    <!-- Conteúdo principal da página -->
    <main class="app-content">

      <!-- Cabeçalho da Página do Fórum -->
      <section class="page-header">
        <h2>Fórum da Comunidade</h2>
      </section>
      <p class="page-subtitle">
        Deixe sua dúvida ou compartilhe sua experiência de forma anônima.
      </p>

      <!-- Container que agrupa o formulário e o feed -->
      <div class="forum-container">

        <!-- Formulário de Nova Postagem (Corrigido) -->
        <div class="new-post-form post-card">
          <h3>Nova Postagem</h3>

          <form id="post-form">
            <div class="form-group">
              <label for="post-input">Sua mensagem:</label>
              <textarea id="post-input" rows="4" placeholder="Escreva sua dúvida ou conselho..." required></textarea>
            </div>
            <button type="submit" class="btn-primary" id="submit-button">
              Publicar
            </button>
          </form>
        </div>

        <!-- Feed de Postagens (Será preenchido pelo JS) -->
        <div class="post-feed" id="post-feed">
          <div class="feed-status-message" id="feed-status-message">
            Carregando postagens...
          </div>
        </div>

        <!-- Controlo de Paginação -->
        <div class="pagination-controls" id="pagination-controls">
          <button class="btn-secondary" id="prev-page-btn" disabled>
            <span class="material-symbols-outlined">arrow_back</span>
            Anterior
          </button>
          <button class="btn-secondary" id="next-page-btn" disabled>
            Próxima
            <span class="material-symbols-outlined">arrow_forward</span>
          </button>
        </div>

      </div>

    </main>
  </div>


  <button id="chat-toggle" aria-label="Open chat" class="fixed bottom-7 
  right-6 bg-blue-500
  hover:bg-blue-700 
  text-white font-bold py-2 px-2 rounded-full shadow-lg z-50 focus:outline-none">
    Chat de apoio
  </button>

  <div id="chat-widget" class="fixed bottom-20 
  right-6 w-80 h-96 
  bg-white border 
  border-gray-300 
  rounded-lg shadow-lg z-50 
  flex flex-col hidden">

    <div class="bg-blue-600 text-white px-4 py-2 rounded-t-lg flex justify-between items-center">
      <span>Local de apoio virtual</span>
      <button id="chat-close" aria-label="Close chat" class="text-white">×</button>
    </div>
    <div id="chat-messages" class="flex-1 p-4 overflow-y-auto">
    </div>
    <div class="p-4 border-t border-gray-300 flex">
      <input id="chat-input" type="text" placeholder="Digite sua mensagem..." class="flex-1 px-3 py-2 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
      <button id="chat-send" class="bg-blue-600 
      hover:bg-blue-700 text-white px-4 py-2 rounded-r-lg">Enviar</button>
    </div>
  </div>
  <script>
    const toggle = document.getElementById('chat-toggle');
    const widget = document.getElementById('chat-widget');
    const closeBtn = document.getElementById('chat-close');
    const messagesDiv = document.getElementById('chat-messages');
    const input = document.getElementById('chat-input');
    const sendBtn = document.getElementById('chat-send');


    const responses = {
      // 1. Palavras-chave Emocionais (Validação) - Aqui eu adicione palavras mais comuns relacionadas a emoções, esse chatbot é focado em apoio psicológico/ apenas apoio, a intenção é que o usuário se sinta acolhido minimamente e ser lembrado de procurar um profissional.
      'stress': 'Entendo que o estresse pode ser desafiador. Lembre-se sempre que você não pode controlar eventos externos, mas sim você mesmo. Aprenda a lidar com o externo e tente técnicas de respiração profunda ou atividades relaxantes. Lembre-se, isto é apenas um canal de apoio; consulte um profissional para ajuda especializada.',
      'estresse': 'Entendo que o estresse pode ser desafiador. Tente lembrar sempre que você não pode controlar eventos externos, mas sim você mesmo. Aprenda a lidar com o externo e tente técnicas de respiração profunda ou atividades relaxantes. Lembre-se, este é apenas apoio; consulte um profissional para ajuda especializada.',
      'ansiedade': 'A ansiedade é comum, mas pode ser gerenciada. Cuide de você mesmo, faça exercícios fisícos e cuidado com excesso de ideias e informações sobre um assunto que você esteja interessado, pois isso pode lhe prejudicar posteriormente. Isto aqui oferece apoio inicial; busque atendimento profissional para tratamento adequado.',
      'ansioso': 'A ansiedade é comum, mas pode ser gerenciada. Cuide de você mesmo, faça exercícios fisícos e cuidado com excesso de ideias e informações sobre um assunto que você esteja interessado, pois isso pode lhe prejudicar posteriormente. Isto aqui oferece apoio inicial; busque atendimento profissional para tratamento adequado.',
      'depressão': 'Se você está se sentindo deprimido, é importante falar com alguém.  Isto aqui é um espaço de apoio, mas um psicólogo pode fornecer o suporte e o atendimento necessário.',
      'depressao': 'Se você está se sentindo deprimido, é importante falar com alguém.  Isto aqui é um espaço de apoio, mas um psicólogo pode fornecer o suporte e o atendimento necessário.',
      'triste': 'Sinto muito que você esteja se sentindo assim. Compartilhar sentimentos é um primeiro passo. Lembre-se de que iste é somente apoio, e não substitui terapia profissional.',
      'sozinho': 'A solidão é um sentimento difícil. Conectar-se com amigos, família ou grupos de interesse pode ajudar. E lembre-se, buscar apoio profissional é um sinal de força.',
      'raiva': 'Sentir raiva é normal, mas é importante entender a raiz dela, e saber enxergar o nível dessa sua emoção para a situação. Tente identificar o gatilho. Falar sobre isso com um profissional pode ajudar a gerenciar essa emoção.',

      // 3. Palavras-chave de Contexto (Universidade/Vida)
      'sono': 'Problemas de sono podem afetar a saúde mental. Estabeleça uma rotina e evite telas antes de dormir. Consulte um especialista se persistir.',
      'relacionamento': 'Relacionamentos podem ser fonte de estresse. Comunicação aberta é chave. Este chatbot apoia, mas terapia de casal pode ajudar.',
      'trabalho': 'O equilíbrio entre trabalho e vida pessoal é importante. Defina limites e cuide de si. Busque apoio profissional se necessário.',
      'família': 'Família é importante, mas conflitos podem surgir. Tente diálogo e empatia. Iste é um apoio inicial; considere terapia familiar, para poder lhe ajudar de alguma forma.',
      'autoestima': 'Trabalhar a autoestima leva tempo. Foque em suas qualidades positivas. Eu consigo lhe incentivar, mas psicólogos especializados ajudam.',
      'motivacao': 'Falta de motivação pode ser sinal de algo maior. Pequenos passos ajudam, da mesma forma que você não pode entrar na academia e ir pegando muito peso, no geral você também não pode estar fazendo isso. Lembre-se, isto é apoio; procure ajuda profissional.',
      'prova': 'A pressão das provas e do meio acadêmico é real. Tente organizar seu tempo de estudo e faça pausas. Lidar com essa ansiedade é importante.',
      'faculdade': 'A vida universitária pode ser estressante. Gerenciar o tempo entre estudos, trabalho e vida social é um desafio. Estamos aqui para apoiar e te incentivar a ter atitudes que vão agregar algo de útil na sua vida.',
      'procrastinação': 'A procrastinação muitas vezes está ligada à ansiedade ou sobrecarga. Tente quebrar tarefas grandes em passos menores. Você não está sozinho nisso, procure por uma rede de apoio que possa lhe ajudar.',
      'padrao': 'Desculpa, mas infelizmente eu não consegui identificar o que você quis dizer. Eu sou uma versão em treinamento, em breve poderei te ajudar ainda mais! Lembre-se, eu não substituo um atendimento profissional. Recomendo que você procure um psicólogo ou outro profissional de saúde mental para obter ajuda especializada.'
    };
    ;

    // Função para adicionar mensagem ao chat
    function addMessage(text, sender) {
      const messageDiv = document.createElement('div');
      messageDiv.className = sender === 'user' ? 'mb-2 text-right' : 'mb-2 text-left';
      messageDiv.innerHTML = `<div class="inline-block p-2 rounded-lg ${sender === 'user' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800'}">${text}</div>`;
      messagesDiv.appendChild(messageDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    // Função para gerar resposta do bot
    function getBotResponse(userMessage) {
      const lowerMessage = userMessage.toLowerCase();
      for (const keyword in responses) {
        if (lowerMessage.includes(keyword)) {
          return responses[keyword];
        }
      }
      return responses['padrao'];
    }

    // Essa é a função para enviar mensagem, como o próprio nome já diz
    function sendMessage() {
      const message = input.value.trim();
      if (message) {
        addMessage(message, 'user');
        input.value = '';
        setTimeout(() => {
          const botResponse = getBotResponse(message);
          addMessage(botResponse, 'bot');
        }, 1000); // Simula delay
      }
    }

    // É basicamente a listagem dos eventos, tendeu peão?
    toggle.addEventListener('click', () => {
      widget.classList.toggle('hidden');
      if (!widget.classList.contains('hidden')) {
        // Mensagem inicial do bot
        if (messagesDiv.children.length === 0) {
          addMessage('Olá! Sou um chatbot de apoio psicológico para homens. Posso oferecer suporte inicial, mas lembre-se: eu não substituo um atendimento profissional. Como posso lhe incentivar para o seu bem hoje?', 'bot');
        }
      }
    });
    closeBtn.addEventListener('click', () => widget.classList.add('hidden'));
    sendBtn.addEventListener('click', sendMessage);
    input.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });
  </script>
  <!-- Fim do .app-container -->

  <!-- Rodapé Global -->
  <footer class="app-footer">
    <div class="footer-content">
      <p>&copy; 2025 ManUp. Um projeto MVP Saúde do Homem - UNINASSAU.</p>
    </div>
  </footer>

  <!-- Scripts do Firebase -->
  <script type="module">
    // Importa as funções de SDK necessárias
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

    // Novas importações (Likes e Paginação)
    import {
      getFirestore,
      collection,
      addDoc,
      onSnapshot,
      query,
      orderBy,
      serverTimestamp,
      doc,
      updateDoc,
      increment,
      limit,
      startAfter,
      getDocs,
      endBefore,
      limitToLast
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // --- Configuração das Chaves ---
    window.__firebase_config = JSON.stringify({
      apiKey: "AIzaSyBKOohYXxCaXnsua6n4THW45AA-BlZL1JE",
      authDomain: "faq---manup.firebaseapp.com",
      projectId: "faq---manup",
      storageBucket: "faq---manup.firebasestorage.app",
      messagingSenderId: "788949316021",
      appId: "1:788949316021:web:5a15162f6074c3954aa9fc",
      measurementId: "G-YL6CM6EZQ6"
    });

    // Disponibiliza as funções para o faq.js
    window.firebase = {
      initializeApp,
      getAuth,
      signInAnonymously,
      signInWithCustomToken,
      getFirestore,
      collection,
      addDoc,
      onSnapshot,
      query,
      orderBy,
      serverTimestamp,
      doc,
      updateDoc,
      increment,
      limit,
      startAfter,
      getDocs,
      endBefore,
      limitToLast
    };
  </script>

  <!-- Script da Página (Lógica do Fórum) -->
  <script type="module" src="../Script/faq.js"></script>
  <script>
    // Executa assim que a página (HTML, imagens) terminar de carregar
    window.addEventListener('load', () => {

      // 1. Pega o nome que foi salvo no localStorage (no Passo 2)
      const nomeSalvo = localStorage.getItem('nomeUsuario');

      // 2. Verifica se o nome realmente existe
      if (nomeSalvo) {

        // 3. Pega TODOS os elementos que têm a classe "nome-usuario"
        const elementosNome = document.querySelectorAll('.nome-usuario');

        // 4. Passa por cada um e substitui o texto
        elementosNome.forEach((elemento) => {
          elemento.textContent = nomeSalvo;
        });

      } else {
        // Opcional: Se não achou o nome, o usuário não logou
        console.error("Usuário não logado! Nome não encontrado no localStorage.");
        // Você pode redirecionar de volta ao login se quiser:
        // window.location.href = '/login.html';
      }
    });
  </script>
</body>

</html>